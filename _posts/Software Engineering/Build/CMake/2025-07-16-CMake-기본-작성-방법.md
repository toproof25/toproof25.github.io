---
title: CMake 기본 작성 방법
description: null
date: 2025-07-16
categories:
- Software Engineering
- Build
- CMake
tags:
- CPP
- Cmake
img: /assets/img/2025-07-16-CMake-기본-작성-방법/
---
## CMake 기본 작성 방법
> CMake는 다양한 환경에서도 일관된 빌드를 할 수 있도록 `CMakeLists.txt` 설정 파일을 설정한다
> 처음 설정할 때는 상당히 뭔가 어렵고 복잡해 보였는데 단계별로 나누고 이해해보니 나름 설정에 있어서 부담이 줄어들었다

### 프로젝트 기본 설정
- `cmake_minimum_required(VERSION 4.1.0 )` 사용할 CMake의 버전을 설정
- `project(GradeManager CXX)` GradeManager는 프로젝트 이름을 정의하고 CXX는 C++ 언어를 의미한다
- `set(CMAKE_CXX_STANDARD 20)` C++의 버전을 C++20 표준으로 컴파일을 지시
- `set(CMAKE_CXX_STANDARD_REQUIRED ON)` 해당 설정의 ON은 C++20표준을 사용하는 것을 강제함
  ```
  # 프로젝트 기본 설정
	cmake_minimum_required(VERSION 4.1.0 )
	project(GradeManager CXX)

	set(CMAKE_CXX_STANDARD 20)
	set(CMAKE_CXX_STANDARD_REQUIRED ON)
  ```

### .cpp 파일들을 Library로 설정
- 해당 과정은 main을 포함한 .cpp 파일을 제외하고, 나머지 .cpp파일을 라이브러리로 지정한다는 것을 의미힌다
- 핵심은 `add_library`로 해당 부분에 작성된 .cpp파일들은 라이브러리로 지정이 된다.
  또한 `add_library(그룹이름 소스파일)`로 이후 헤더 파일 경로를 지정할 때 그룹이름을 사용한다.
- 나머지 fild, list 과정은 간단하게 `src/*.cpp`해당 디렉토리에 모든 .cpp파일을 SRC라는 변수에 저장하고, list에서는 main 파일 하나를 제거한다
  **즉 main을 포함한 .cpp을 제외한 모든 .cpp파일을 리스트로 담아 add_library에 적용**
  ```
	# 1. 모든 핵심 소스 코드를 포함하는 라이브러리 타겟을 정의
	# main cpp을 제외하고 나머지 .cpp 파일을 모두 라이브러리로 지정
	  # src/ 내 모든 cpp을 SRC 변수에 저장
	  file(GLOB SRC 
	      "${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp"
	  )
	
	  # 위에서 만든 .cpp이 있는 SRC 변수에서 main함수가 포함된 grade_manager.cpp을 제거
	  list(REMOVE_ITEM SRC
	      "${CMAKE_CURRENT_SOURCE_DIR}/src/grade_manager.cpp"
	  )
	
	  # 최종적으로 src/ 에 grade_manager.cpp을 제외하고 모두 라이브러리에 등록
	  add_library(GradeManagerLib
	      ${SRC}
	  )
  ```

### 설정한 라이브러리 파일에 헤더 파일 경로를 설정
- `target_include_directories`은 헤더 파일의 경로를 지정한다
  `GradeManagerLib`해당 그룹을 컴파일 할 때 `#include`에 대해서 헤더 파일을 찾을 수 있도록 **경로를 지정**해준다
- 즉 직접 만든 `.h`파일들이나 사용한 라이브러리 파일들을 `.cpp`파일을 컴파일 할 때 제대로 컴파일 할 수 있도록 경로를 지정
  ```
	# 2. 라이브러리에 필요한 헤더 파일 경로를 지정합니다.
	# 1번에서 .cpp 에 사용되는 모든 .h, .hpp 파일들의 경로를 지정
	# 즉 1번 .cpp을 컴파일하는 과정에서 만나는 #include 헤더 파일들을 아래에 지정한 경로에서 찾는다
	target_include_directories(GradeManagerLib PUBLIC 
	        ${CMAKE_CURRENT_SOURCE_DIR}/inc 
	        ${CMAKE_CURRENT_SOURCE_DIR}/lib)  
  ```

### 실행 파일 설정
- 실행 파일을 설정하기 위해 main함수가 포함된 파일을 대상으로 `add_executable`을 수행한다
- `add_executable(실행파일명 .cpp 파일 경로)`에서 첫번째는 생성될 실행파일의 이름이고, 두번째는 main함수가 포함된 .cpp파일 경로를 설정한다
  ```
	# 3. main cpp 파일을 실행 파일로 만드는 과정
	# add_executable(실행파일명 .cpp 파일 경로)   
	add_executable(GradeManagerApp src/grade_manager.cpp) 
  ```


### main파일과 라이브러리들을 Link
- 실행파일을 만들 소스파일을 설정하고, 설정된 라이브러리 파일들을 컴파일 한 후 main파일과 **Link하는 단계**이다.
  **이전에 설정한 라이브러리 파일들은 \[전처리->오브젝트 파일]로 변환되어 main파일과 Link되는 과정**
  ```
	# 4. 실행 파일에 위에서 만든 라이브러리를 연결(link)합니다.
	# GradeManagerLib의 소스코드와 헤더 경로 설정이 GradeManagerApp에 전달됩니다.
	target_link_libraries(GradeManagerApp PRIVATE GradeManagerLib)
  ```

## 전체 설정 내용
```text
# 프로젝트 기본 설정
cmake_minimum_required(VERSION 4.1.0 )
project(GradeManager CXX)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# 1. 모든 핵심 소스 코드를 포함하는 라이브러리 타겟을 정의
# main cpp을 제외하고 나머지 .cpp 파일을 모두 라이브러리로 지정
  # src/ 내 모든 cpp을 SRC 변수에 저장
  file(GLOB SRC 
      "${CMAKE_CURRENT_SOURCE_DIR}/src/*.cpp"
  )

  # 위에서 만든 .cpp이 있는 SRC 변수에서 main함수가 포함된 grade_manager.cpp을 제거
  list(REMOVE_ITEM SRC
      "${CMAKE_CURRENT_SOURCE_DIR}/src/grade_manager.cpp"
  )

  # 최종적으로 src/ 에 grade_manager.cpp을 제외하고 모두 라이브러리에 등록
  add_library(GradeManagerLib
      ${SRC}
  )

# 2. 라이브러리에 필요한 헤더 파일 경로를 지정합니다.
# 1번에서 .cpp 에 사용되는 모든 .h, .hpp 파일들의 경로를 지정
# 즉 1번 .cpp을 컴파일하는 과정에서 만나는 #include 헤더 파일들을 아래에 지정한 경로에서 찾는다
target_include_directories(GradeManagerLib PUBLIC 
        ${CMAKE_CURRENT_SOURCE_DIR}/inc 
        ${CMAKE_CURRENT_SOURCE_DIR}/lib)   

# 3. main cpp 파일을 실행 파일로 만드는 과정
# add_executable(실행파일명 .cpp 파일 경로)   
add_executable(GradeManagerApp src/grade_manager.cpp)       

# 4. 실행 파일에 위에서 만든 라이브러리를 연결(link)합니다.
# GradeManagerLib의 소스코드와 헤더 경로 설정이 GradeManagerApp에 전달됩니다.
target_link_libraries(GradeManagerApp PRIVATE GradeManagerLib)

set(CPACK_PROJECT_NAME ${PROJECT_NAME}) # 실행파일명
set(CPACK_PROJECT_VERSION ${PROJECT_VERSION}) # 실행파일버전
include(CPack) # 기본적으로 build 경로에 실행파일을 생성함
```



---
## 링크 및 참고자료

##### 링크 문서
- 

##### 참고자료(출처)
- 





