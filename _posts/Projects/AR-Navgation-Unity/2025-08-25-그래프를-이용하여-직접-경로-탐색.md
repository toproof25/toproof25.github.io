---
title: 그래프를 이용하여 직접 경로 탐색
description: null
date: 2025-08-25
categories:
- Projects
- AR Navgation Unity
tags:
- 지식
- 캡스톤VR
- 자료구조
- 그래프
- 경로탐색알고리즘
img: /assets/img/2025-08-25-그래프를-이용하여-직접-경로-탐색/
---
## 그래프를 이용하여 직접 경로 탐색
> 기존 방법에서는 아래의 API를 사용했었다
> 	경로 : Tmap API
> 	고도 : Google Elevation
> 	앵커 배치 : AR Core Extensions
> 경로를 API로 사용할 시 문제점은 학교 내 지름길 (샬 뒷길, 자취촌 가는 길)이 표시되지 않는 부분이다. 이를 무시하기에는 사실상 매우 활발하게 사용되는 길이기에 표시되지 않는 문제를 해결해야 한다.
> 고도의 문제점도 어느정도는 일치하지만 전체적으로 모두 일치하지는 않는다. 일부는 정상이나 일부는 위 혹은 아래쪽으로 앵커가 배치되어 사용자에게 사실상 보이지 않는 문제가 있다
> 
> 위 문제들을 해결하기 위해 지름길도 경로에 추가되면서 고도를 제대로 맞추기 위해 직접 경위도 + 고도를 설정하여 그래프 자료구조와 경로 탐색 알고리즘으로 경로를 얻고자 한다.

### Node 생성을 위한 유니티 세팅
- 경로를 구하는 방법으로 직접 학교를 돌아다니며 각 경위도마다 고도값을 설정하고자 한다
  ![경로를 구하는 방법으로 직접 학교를 돌아다니며 각 경위도마다 고도값을 설정하고자 한다]({{page.img}}경로를 구하는 방법으로 직접 학교를 돌아다니며 각 경위도마다 고도값을 설정하고자 한다.webp)
- 이처럼 노드 생성을 누를 시 현재 스마트폰에 경위도와 설정된 고도값, 노드 이름을 작성하여 아래와 같은 형식의 JSON 데이터를 저장한다
- 앵커 생성을 먼저 하여 의도한 위치에 나타나는지 먼저 확인
- 고도의 경우는 Up, Down 버튼을 통해 조절하면서 생성하며, 최종적으로 의도한 위치에 앵커가 배치된다면, 노드 생성을 통해 아래와 같이 생성 후 저장
  ![스마트폰에 저장된 JSON데이터를 유니티 프로젝트 내에 이동하여 유니티에서 처리할 수 있도록 한다]({{page.img}}스마트폰에 저장된 JSON데이터를 유니티 프로젝트 내에 이동하여 유니티에서 처리할 수 있도록 한다.webp)

### `Pathfinder` 경로 탐색 컴포넌트 구현
- 우선 JSON 데이터를 유니티에서 다루기 위해 직렬화 클래스를 제작
  ```json
	// JSON 파일의 전체 구조와 일치하는 클래스
	[Serializable]
	public class GraphData
	{
	    public List<Node> nodes;
	    public List<Edge> edges;
	}
	
	// 노드(정점) 정보를 담는 클래스
	[Serializable]
	public class Node
	{
	    public int id;
	    public string name;
	    public double lat; // 위도
	    public double lng; // 경도
	    public double alt; // 고도
	    public string sign;
	
	    // 경로 탐색을 위한 간선 목록
	    [NonSerialized]
	    public List<Edge> edges = new List<Edge>();
	}
	
	// 간선(엣지) 정보를 담는 클래스. 두 노드 사이의 연결과 비용을 정의
	[Serializable]
	public class Edge
	{
	    public int source; // 출발 노드 ID
	    public int target; // 도착 노드 ID
	    public float cost; // 비용
	}


  ```
- 싱글톤을 이용하여 간단하게 경로 탐색을 호출할 수 있는 인스턴스를 구현
- 간단한 알고리즘 설명
  1. 컴포넌트 `Start`에서 `node.json`을 불러와 클래스에 적용 및 각 노드 id에 따라 `Dictionary` 를 생성하여 바로 노드를 가져올 수 있도록 설정
  2. `FindPath`함수에는 출발지, 목적지 경위도를 바탕으로 경로를 반환하는 함수
    1. 각 출발지, 목적지 경위도에서 가장 가까운 노드를 구한다
    2. A* 알고리즘을 이용하여 경로를 탐색
- 아래와 같이 제대로 그래프가 구현되고, 도서관 -> 이공관까지 경로를 찾는 로그를 확인
  ![아래와 같이 제대로 그래프가 구현되고 경로를 찾는 로그를 확인]({{page.img}}아래와 같이 제대로 그래프가 구현되고 경로를 찾는 로그를 확인.webp)


### 기존 AR앵커 배치 컴포넌트 수정
- 기존에 Tmap API에 요청하고, 받은 후 직렬화 하고... 앵커배치하기 전에 Google Elevation API를 이용하여 고도를 가져와서 최종적으로 앵커를 배치하는 방식
- 위 과정을 구현한 경로 탐색 컴포넌트를 이용하여 `List<Node> pathNodes = Pathfinder.instance.FindPath(lat, lon, destinationLatitude, destinationLongitude);`이 한줄로 모두 구할 수 있었다
- 이후 얻은 리스트를 순차적으로 반복하며, 각 노드에 있는 경위도와 고도를 바탕으로 앵커를 배치하기만 하면 앵커가 배치된다

### 문제점
- 우선 앵커가 경로대로 배치되기는 하나 아무리 Google AR Core Extensions를 사용하더라고 완전 정확한 위치에 배치되지는 않는다
- 나무에 가려지거나 도보에 바로 나타나지는 않아 문제가 발생

### 추가 아이디어
- 기존 방법과 현재 방법에서 정확도 등을 데이터로 비교 할 수 있으면 좋을 듯
- 경로를 구하는 부분을 유니티가 아닌 다른 서버에 두어 요청, 응답 방식으로 직접 구현해보기?


### 구현 과정에서의 느낌
- 사실 초반에는 Tmap이나 Google뿐만 아니라 Naver, Mapbox 등 각 라이브러리, API에 많이 의존하면서 해야할 거 같았다
- 하지만 문제가 발생하고 해결 방법을 모색하면서 실제로 생각했던 대로 구현이 되었다는게 조금은 신기하면서 재미있었다
- 또한 나도 이거를 조금 더 정밀하게 한다면 나름 나만의 API를 만드는 게 아닌가란 생각이 든다. 추후 다른 강남대생이 학교에 대한 경위도와 고도 데이터가 필요하다면 내가 만들었던 이 데이터가 좋은 방향으로 누군가에게 도움이 될 수도 있지 않을까란 생각도 해봤다
-



---
## 링크 및 참고자료

##### 링크 문서
- 

##### 참고자료(출처)
- 



